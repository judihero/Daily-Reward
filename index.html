<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Reward Check-in</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- New Heading for Daily Rewards -->
        <h1 class="title">Daily Rewards</h1> <!-- Added title here -->
        
    <!-- Current Points Section -->
    <div class="points-section">
        <h2>Current point</h2>
        <p id="points">0</p>
    </div>

    <!-- Check-In Items -->
    <div class="checkin-grid">
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(1)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+1</span>
            </div>
            <p class="day-label">Day 1</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(2)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+2</span>
            </div>
            <p class="day-label">Day 2</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(3)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+3</span>
                </div>
            <p class="day-label">Day 3</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(4)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+4</span>
                </div>
            <p class="day-label">Day 4</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(5)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+5</span>
                </div>
            <p class="day-label">Day 5</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(6)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+6</span>
                </div>
            <p class="day-label">Day 6</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(7)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+7</span>
                </div>
            <p class="day-label">Day 7</p>
        </div>
    </div>

    <!-- Check In Today Button -->
    <button class="checkin-button" onclick="checkIn()">Check In Today</button>

    <!-- Message Section -->
    <div id="message-section" style="display: none; color: red; font-weight: bold;"></div>

    <!-- Rewards Section -->
    <div id="rewards-section" class="rewards-section">
        <div class="reward-item">
            <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
            <div>
                <p>Wallet Angpow</p>
                <p>RM 8</p>
            </div>
            <div class="reward-points">35 Points</div>
        </div>
        <div class="reward-item">
            <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
            <div>
                <p>Wallet Angpow</p>
                <p>RM 18</p>
            </div>
            <div class="reward-points">50 Points</div>
        </div>
        <!-- Add more rewards as needed -->
        <!-- Additional Rewards -->
    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 28</p>
        </div>
        <div class="reward-points">65 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 38</p>
        </div>
        <div class="reward-points">74 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 58</p>
        </div>
        <div class="reward-points">95 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 88</p>
        </div>
        <div class="reward-points">110 Points</div>
    </div>

    <!-- High-Value Rewards -->
    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/1512d64a73376b9e99643.png" alt="Cash Voucher">
        <div>
            <p>Cash Voucher</p>
            <p>RM 188</p>
        </div>
        <div class="reward-points">600 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/1512d64a73376b9e99643.png" alt="Cash Voucher">
        <div>
            <p>Cash Voucher</p>
            <p>RM 288</p>
        </div>
        <div class="reward-points">850 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/7bd77eaa73376c8a3516c.png" alt="Apple AirPods">
        <div>
            <p>Apple</p>
            <p>AirPods</p>
        </div>
        <div class="reward-points">1500 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/432756ea73376f5f91903.webp" alt="Apple iPhone">
        <div>
            <p>Apple</p>
            <p>iPhone 16 Pro Max</p>
        </div>
        <div class="reward-points">2350 Points</div>
</div>
    </div>
</div>

<!-- Place the JavaScript code here, before the closing </body> tag -->
    <script>
        const ACCESS_ID = '254560538';  // Replace with your actual Access ID
        const TOKEN = '03e729dbdf5db7c33d824bf8288e10a240b433a989b91d44d0e9c214cd2c051b'; // Replace with actual token
        let isUserLoggedIn = false;
        let hasDepositedToday = false;

        /**
         * Show a message to the user.
         */
        function showMessage(message) {
            const messageSection = document.getElementById("message-section");
            messageSection.style.display = "block";
            messageSection.innerText = message;
        }

        /**
         * Redirect user to the main website login page.
         */
        function redirectToLogin() {
            window.location.href = "https://jdk88c.com/login";
        }

        /**
         * Validate if the user is logged in.
         */
        async function validateUser() {
            const formdata = new FormData();
            formdata.append("module", "/users/validateSession");
            formdata.append("accessId", ACCESS_ID);
            formdata.append("accessToken", TOKEN);

            const requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            };

            try {
                const response = await fetch("https://jdk88a.com/api/v1/index.php", requestOptions);
                if (!response.ok) {
                    throw new Error("Validation failed.");
                }

                const data = await response.json();
                console.log("Validation Response:", data);
                isUserLoggedIn = data.valid || false;

                return isUserLoggedIn;
            } catch (error) {
                console.error("Error validating user:", error);
                showMessage("An error occurred while validating user. Please try again.");
                return false;
            }
        }

        /**
         * Check if the user has made a deposit today.
         */
        async function checkDeposit() {
            const today = new Date().toISOString().split('T')[0]; // Get today's date
            const sDate = `${today}T00:00:00Z`;
            const eDate = `${today}T23:59:59Z`;

            const formdata = new FormData();
            formdata.append("module", "/transactions/getAllTransactions");
            formdata.append("accessId", ACCESS_ID);
            formdata.append("accessToken", TOKEN);
            formdata.append("sDate", sDate);
            formdata.append("eDate", eDate);
            formdata.append("type", "DEPOSIT");

            const requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            };

            try {
                const response = await fetch("https://jdk88a.com/api/v1/index.php", requestOptions);
                if (!response.ok) {
                    throw new Error("Failed to fetch deposit status.");
                }

                const data = await response.json();
                console.log("Deposit Data:", data);

                if (data.transactions && data.transactions.length > 0) {
                    const depositAmount = data.transactions.reduce((sum, txn) => sum + txn.amount, 0);

                    if (depositAmount >= 5) {
                        hasDepositedToday = true;
                        document.getElementById("message-section").style.display = "none";
                    } else {
                        hasDepositedToday = false;
                        showMessage("Deposit untuk claim");
                    }
                } else {
                    hasDepositedToday = false;
                    showMessage("Deposit untuk claim");
                }
            } catch (error) {
                console.error("Error checking deposit:", error);
                showMessage("Failed to validate deposit status.");
            }
        }

        /**
         * Handle the Check-In button click.
         */
        async function checkIn() {
            // Validate user login
            const isValidUser = await validateUser();
            if (!isValidUser) {
                redirectToLogin();
                return;
            }

            // Check deposit status
            await checkDeposit();

            // If user has not deposited today, show message and stop
            if (!hasDepositedToday) {
                return;
            }

            // Handle successful check-in
            console.log("User is checking in...");
            const formdata = new FormData();
            formdata.append("module", "/users/checkIn");
            formdata.append("accessId", ACCESS_ID);
            formdata.append("accessToken", TOKEN);

            const requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            };

            try {
                const response = await fetch("https://jdk88a.com/api/v1/index.php", requestOptions);
                if (!response.ok) {
                    throw new Error("Check-in failed.");
                }

                const data = await response.json();
                console.log("Check-In Response:", data);

                if (data.error) {
                    showMessage(data.message || "Check-in failed.");
                } else {
                    alert("Check-in successful!");
                    document.getElementById('points').innerText = data.updatedPoints || '0';
                }
            } catch (error) {
                console.error("Check-in error:", error);
                showMessage("Failed to check in.");
            }
        }

        // Validate user on page load
        document.addEventListener('DOMContentLoaded', async () => {
            const isValidUser = await validateUser();
            if (!isValidUser) {
                redirectToLogin();
            }
        });
    </script>
</body>
</html>

