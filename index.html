<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Reward Check-in</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- New Heading for Daily Rewards -->
        <h1 class="title">Daily Rewards</h1> <!-- Added title here -->
        
    <!-- Current Points Section -->
    <div class="points-section">
        <h2>Current point</h2>
        <p id="points">0</p>
    </div>

    <!-- Check-In Items -->
    <div class="checkin-grid">
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(1)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+1</span>
            </div>
            <p class="day-label">Day 1</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(2)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+2</span>
            </div>
            <p class="day-label">Day 2</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(3)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+3</span>
                </div>
            <p class="day-label">Day 3</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(4)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+4</span>
                </div>
            <p class="day-label">Day 4</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(5)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+5</span>
                </div>
            <p class="day-label">Day 5</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(6)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+6</span>
                </div>
            <p class="day-label">Day 6</p>
        </div>
        <div class="checkin-container">
            <div class="checkin-item" onclick="addPoints(7)">
                <img src="https://static.gwvkyk.com/media/7df13490283761780a7bd.png" alt="Check-in Icon">
                <span>+7</span>
                </div>
            <p class="day-label">Day 7</p>
        </div>
    </div>

    <!-- Check In Today Button -->
    <button class="checkin-button" onclick="checkIn()">Check In Today</button>

    <!-- Rewards Section -->
    <div id="rewards-section" class="rewards-section">
        <div class="reward-item">
            <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
            <div>
                <p>Wallet Angpow</p>
                <p>RM 8</p>
            </div>
            <div class="reward-points">35 Points</div>
        </div>
        <div class="reward-item">
            <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
            <div>
                <p>Wallet Angpow</p>
                <p>RM 18</p>
            </div>
            <div class="reward-points">50 Points</div>
        </div>
        <!-- Add more rewards as needed -->
        <!-- Additional Rewards -->
    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 28</p>
        </div>
        <div class="reward-points">65 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 38</p>
        </div>
        <div class="reward-points">74 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 58</p>
        </div>
        <div class="reward-points">95 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/a3e09de073376d7f96065.jpg" alt="Wallet Angpow">
        <div>
            <p>Wallet Angpow</p>
            <p>RM 88</p>
        </div>
        <div class="reward-points">110 Points</div>
    </div>

    <!-- High-Value Rewards -->
    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/1512d64a73376b9e99643.png" alt="Cash Voucher">
        <div>
            <p>Cash Voucher</p>
            <p>RM 188</p>
        </div>
        <div class="reward-points">600 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/1512d64a73376b9e99643.png" alt="Cash Voucher">
        <div>
            <p>Cash Voucher</p>
            <p>RM 288</p>
        </div>
        <div class="reward-points">850 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/7bd77eaa73376c8a3516c.png" alt="Apple AirPods">
        <div>
            <p>Apple</p>
            <p>AirPods</p>
        </div>
        <div class="reward-points">1500 Points</div>
    </div>

    <div class="reward-item">
        <img src="https://static.gwvkyk.com/media/432756ea73376f5f91903.webp" alt="Apple iPhone">
        <div>
            <p>Apple</p>
            <p>iPhone 16 Pro Max</p>
        </div>
        <div class="reward-points">2350 Points</div>
</div>
    </div>
</div>

<!-- Place the JavaScript code here, before the closing </body> tag -->
    <script>
    const ACCESS_ID = '254560538';  // Replace with your actual Access ID
    const TOKEN = '03e729dbdf5db7c33d824bf8288e10a240b433a989b91d44d0e9c214cd2c051b'; // Replace with your actual Access Token
    const MIN_DEPOSIT = 5; // Minimum deposit amount in RM

    /**
     * Check if the user has made a valid deposit today.
     */
    async function checkDeposit() {
        console.log("Starting deposit validation...");
        const today = new Date();
        const startOfDay = new Date(today.setUTCHours(0, 0, 0, 0)).toISOString();
        const endOfDay = new Date(today.setUTCHours(23, 59, 59, 999)).toISOString();

        console.log("Start of day:", startOfDay);
        console.log("End of day:", endOfDay);

        const requestBody = {
            module: "/transactions/getAllTransactions",
            accessId: ACCESS_ID,
            accessToken: TOKEN,
            pageIndex: 0,
            sDate: startOfDay,
            eDate: endOfDay,
            type: "DEPOSIT",
            userId: ACCESS_ID
        };

        console.log("Request body for deposit validation:", requestBody);

        try {
            const response = await fetch("https://jdk88a.com/api/v1/index.php", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            console.log("Deposit API response status:", response.status);

            if (!response.ok) {
                console.error("Error response from deposit API:", await response.text());
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            console.log("Deposit API response data:", data);

            if (!data.transactions) {
                console.warn("No transactions found in API response.");
                return false;
            }

            const validTransactions = data.transactions.filter(
                transaction => transaction.amount >= MIN_DEPOSIT
            );

            console.log("Valid transactions:", validTransactions);
            return validTransactions.length > 0;

        } catch (error) {
            console.error("Error during deposit validation:", error);
            return false; // Default to no deposit in case of error
        }
    }

    /**
     * Handle the check-in process.
     */
    async function handleCheckIn() {
        console.log("Handling check-in...");

        // Check if user is logged in
        if (!ACCESS_ID || !TOKEN) {
            console.log("User not logged in. Redirecting to login page...");
            window.location.href = "https://jdk88c.com/login";
            return;
        }

        console.log("User is logged in. Proceeding with deposit validation...");
        const hasDeposited = await checkDeposit();

        if (!hasDeposited) {
            console.log("User has not made a valid deposit today.");
            alert("Min Topup RM 5 untuk claim Point");
            return;
        }

        console.log("User has made a valid deposit. Proceeding with check-in...");

        try {
            const formdata = new FormData();
            formdata.append("module", "checkIn");
            formdata.append("accessId", ACCESS_ID);
            formdata.append("accessToken", TOKEN);

            console.log("Check-in request payload:", [...formdata.entries()]);

            const response = await fetch("https://jdk88a.com/api/v1/index.php", {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            });

            console.log("Check-in API response status:", response.status);

            if (!response.ok) {
                console.error("Error response from check-in API:", await response.text());
                throw new Error("Check-in failed.");
            }

            const data = await response.json();
            console.log("Check-in API response data:", data);

            if (data.error) {
                console.error("Check-in error:", data.message);
                alert(data.message || "Check-in failed due to an unknown error.");
            } else {
                alert("Check-in successful!");
                console.log("Updated points after check-in:", data.updatedPoints);
                document.getElementById('points').innerText = data.updatedPoints; // Update points
            }
        } catch (error) {
            console.error("Check-in error:", error);
            alert("Check-in failed.");
        }
    }

    /**
     * Initialize event listeners on page load.
     */
    document.addEventListener('DOMContentLoaded', () => {
        console.log("DOM fully loaded. Adding event listener for check-in button...");
        document.querySelector('.checkin-button').addEventListener('click', handleCheckIn);
    });
</script>
